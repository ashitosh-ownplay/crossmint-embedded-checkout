"use strict";(self.webpackChunkcrossmint_embedded_checkout=self.webpackChunkcrossmint_embedded_checkout||[]).push([[43379],{43379:(t,e,n)=>{n.r(e),n.d(e,{connectSmartWallet:()=>ht,disconnectSmartWallet:()=>gt,isSmartWallet:()=>mt,personalAccountToSmartAccountMap:()=>lt});var a=n(4427),r=n(84188),s=n(747),i=n(26329),o=n(35834),c=n(44706),u=n(84192);function p(t,e="hex"){const n=d(t),a=(0,o.l)(new Uint8Array(n.length));return n.encode(a),"hex"===e?(0,u.My)(a.bytes):a.bytes}function d(t){return Array.isArray(t)?function(t){const e=t.reduce(((t,e)=>t+e.length),0),n=y(e);return{length:e<=55?1+e:1+n+e,encode(a){e<=55?a.pushByte(192+e):(a.pushByte(247+n),1===n?a.pushUint8(e):2===n?a.pushUint16(e):3===n?a.pushUint24(e):a.pushUint32(e));for(const{encode:e}of t)e(a)}}}(t.map((t=>d(t)))):function(t){const e="string"==typeof t?(0,c.aT)(t):t,n=y(e.length);return{length:1===e.length&&e[0]<128?1:e.length<=55?1+e.length:1+n+e.length,encode(t){1===e.length&&e[0]<128?t.pushBytes(e):e.length<=55?(t.pushByte(128+e.length),t.pushBytes(e)):(t.pushByte(183+n),1===n?t.pushUint8(e.length):2===n?t.pushUint16(e.length):3===n?t.pushUint24(e.length):t.pushUint32(e.length),t.pushBytes(e))}}}(t)}function y(t){if(t<256)return 1;if(t<65536)return 2;if(t<2**24)return 3;if(t<2**32)return 4;throw new i.C("Length is too large.")}var m=n(26020),l=n(63809);function f(t){if(["string","number"].includes(typeof t)&&!Number.isInteger(Number(t)))throw new Error(`Expected value to be an integer to convert to a bigint, got ${t} of type ${typeof t}`);return t instanceof Uint8Array?BigInt((0,l.EY)(t)):BigInt(t)}var h=n(54508),g=n(38683),v=n(88452);const w=50000n,b=t=>{const e=function(t){const{gas:e,nonce:n,to:a,from:r,value:s,maxFeePerGas:i,maxPriorityFeePerGas:o,paymaster:c,paymasterInput:u,gasPerPubdata:p,data:d}=t;return{txType:113n,from:BigInt(r),to:a?BigInt(a):0n,gasLimit:e??0n,gasPerPubdataByteLimit:p??w,maxFeePerGas:i??0n,maxPriorityFeePerGas:o??0n,paymaster:c?BigInt(c):0n,nonce:n?BigInt(n):0n,value:s??0n,data:d||"0x0",factoryDeps:[],paymasterInput:u||"0x"}}(t);return{domain:{name:"zkSync",version:"2",chainId:t.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:e}};var x=n(7827),P=n(48034),A=n(37372),G=n(85182),T=n(11569);const I=T.k;var O=n(58146),C=n(24485),L=n(95167);const D="/docs/contract/decodeEventLog";function $({param:t,value:e}){return"string"===t.type||"bytes"===t.type||"tuple"===t.type||t.type.match(/^(.*)\[(\d+)?\]$/)?e:((0,C.n)([t],e)||[])[0]}var B=n(37314);class M extends i.C{constructor(t){super(`Filter type "${t}" is not supported.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"FilterTypeNotSupportedError"})}}var U=n(43264),S=n(94531),j=n(46394),F=n(29873),E=n(22599);function _(t,e){const n=typeof t,a=e.type;switch(a){case"address":return(0,F.P)(t,{strict:!1});case"bool":return"boolean"===n;case"function":case"string":return"string"===n;default:return"tuple"===a&&"components"in e?Object.values(e.components).every(((e,n)=>_(Object.values(t)[n],e))):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(a)?"number"===n||"bigint"===n:/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(a)?"string"===n||t instanceof Uint8Array:!!/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(a)&&Array.isArray(t)&&t.every((t=>_(t,{...e,type:a.replace(/(\[[0-9]{0,}\])$/,"")})))}}function k(t,e,n){for(const a in t){const r=t[a],s=e[a];if("tuple"===r.type&&"tuple"===s.type&&"components"in r&&"components"in s)return k(r.components,s.components,n[a]);const i=[r.type,s.type];if(i.includes("address")&&i.includes("bytes20")||(i.includes("address")&&i.includes("string")||i.includes("address")&&i.includes("bytes"))&&(0,F.P)(n[a],{strict:!1}))return i}}const H="/docs/contract/encodeEventTopics";function N(t){const{abi:e,eventName:n,args:a}=t;let r=e[0];if(n){const t=function(t){const{abi:e,args:n=[],name:a}=t,r=(0,j.q)(a,{strict:!1}),s=e.filter((t=>r?"function"===t.type?(0,E.V)(t)===a:"event"===t.type&&I(t)===a:"name"in t&&t.name===a));if(0===s.length)return;if(1===s.length)return s[0];let i;for(const t of s)if("inputs"in t)if(n&&0!==n.length){if(t.inputs&&0!==t.inputs.length&&t.inputs.length===n.length&&n.every(((e,n)=>{const a="inputs"in t&&t.inputs[n];return!!a&&_(e,a)}))){if(i&&"inputs"in i&&i.inputs){const e=k(t.inputs,i.inputs,n);if(e)throw new A.nM({abiItem:t,type:e[0]},{abiItem:i,type:e[1]})}i=t}}else if(!t.inputs||0===t.inputs.length)return t;return i||s[0]}({abi:e,name:n});if(!t)throw new A.M_(n,{docsPath:H});r=t}if("event"!==r.type)throw new A.M_(void 0,{docsPath:H});const s=(0,L.B)(r),i=I(s);let o=[];if(a&&"inputs"in r){const t=r.inputs?.filter((t=>"indexed"in t&&t.indexed)),e=Array.isArray(a)?a:Object.values(a).length>0?t?.map((t=>a[t.name]))??[]:[];e.length>0&&(o=t?.map(((t,n)=>Array.isArray(e[n])?e[n].map(((a,r)=>V({param:t,value:e[n][r]}))):e[n]?V({param:t,value:e[n]}):null))??[])}return[i,...o]}function V({param:t,value:e}){if("string"===t.type||"bytes"===t.type)return(0,U.S)((0,c.ZJ)(e));if("tuple"===t.type||t.type.match(/^(.*)\[(\d+)?\]$/))throw new M(t.type);return(0,S.h)([t],[e])}function W(t={}){return function(t){const{signature:e}=t;let n;var a;return n=(a=e)&&"object"==typeof a&&"type"in a&&"event"===a.type?e:(0,B.$)(e),{abiEvent:n,hash:(0,T.k)(n),topics:N({abi:[n],args:t.filters})}}({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}var R=n(41253),z=n(30260),q=n(24256),K=n(25419),Z=n(8908);const J=()=>{const t=BigInt(Math.floor(4294967296*Math.random())),e=BigInt(Math.floor(4294967296*Math.random())),n=BigInt(Math.floor(4294967296*Math.random())),a=BigInt(Math.floor(4294967296*Math.random())),r=BigInt(Math.floor(4294967296*Math.random())),s=BigInt(Math.floor(4294967296*Math.random()));return t<<BigInt(160)|e<<BigInt(128)|n<<BigInt(96)|a<<BigInt(64)|r<<BigInt(32)|s},Q=()=>BigInt((0,K.xW)([(0,l.cK)(J()),"0x0000000000000000"]));function Y(t){return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,(0,Z.q)(e)?e:(0,l.nj)(e)])))}async function X(t){const e=await et({...t,operation:"eth_estimateUserOperationGas",params:[Y(t.userOp),t.options.overrides?.entrypointAddress??q.uh]});return{preVerificationGas:(0,l.uU)(e.preVerificationGas),verificationGas:(0,l.uU)(e.verificationGas),verificationGasLimit:(0,l.uU)(e.verificationGasLimit),callGasLimit:(0,l.uU)(e.callGasLimit)+q.L8}}async function tt(t){const e=await et({...t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(e){if(!1===e.success){const t=function(t){const{logs:e,events:n,strict:a}=t;return function({abi:t,eventName:e,logs:n,strict:a=!0}){return n.map((n=>{try{const r=function(t){const{abi:e,data:n,strict:a,topics:r}=t,s=a??!0,[i,...o]=r;if(!i)throw new A._z({docsPath:D});const c=e.find((t=>"event"===t.type&&i===I((0,L.B)(t))));if(!c||!("name"in c)||"event"!==c.type)throw new A.kE(i,{docsPath:D});const{name:u,inputs:p}=c,d=p?.some((t=>!("name"in t&&t.name)));let y=d?[]:{};const m=p.filter((t=>"indexed"in t&&t.indexed));for(let t=0;t<m.length;t++){const e=m[t],n=o[t];if(!n)throw new A.l3({abiItem:c,param:e});y[d?t:e.name||t]=$({param:e,value:n})}const l=p.filter((t=>!("indexed"in t&&t.indexed)));if(l.length>0)if(n&&"0x"!==n)try{const t=(0,C.n)(l,n);if(t)if(d)y=[...y,...t];else for(let e=0;e<l.length;e++)y[l[e].name]=t[e]}catch(t){if(s){if(t instanceof A.Iy||t instanceof O.SK)throw new A.fo({abiItem:c,data:n,params:l,size:(0,G.E)(n)});throw t}}else if(s)throw new A.fo({abiItem:c,data:"0x",params:l,size:0});return{eventName:u,args:Object.values(y).length>0?y:void 0}}({...n,abi:t,strict:a});return e&&!e.includes(r.eventName)?null:{...r,...n}}catch(t){let e,r;if(t instanceof A.kE)return null;if(t instanceof A.fo||t instanceof A.l3){if(a)return null;e=t.abiItem.name,r=t.abiItem.inputs?.some((t=>!("name"in t&&t.name)))}return{...n,args:r?[]:{},eventName:e}}})).filter(Boolean)}({logs:e,abi:n.map((t=>t.abiEvent)),strict:a})}({events:[W()],logs:e.logs}),n=t[0]?.args?.revertReason;if(!n)throw new Error(`UserOp failed at txHash: ${e.transactionHash}`);const a=(0,P.W)({data:n});throw new Error(`UserOp failed with reason: '${a.args.join(",")}' at txHash: ${e.transactionHash}`)}return e.receipt}}async function et(t){const{options:e,operation:n,params:a}=t;q.Oi&&console.debug(`>>> sending ${n} with payload:`,a);const r=e.overrides?.bundlerUrl??(0,q.RZ)(e.chain),s=(0,R.KI)(e.client),i=await s(r,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,z.A)({jsonrpc:"2.0",id:1,method:n,params:a})}),o=await i.json();if(!i.ok||o.error){let t=o.error||i.statusText;"object"==typeof t&&(t=JSON.stringify(t));const e=o.code||"UNKNOWN";throw new Error(`${n} error: ${t}\nStatus: ${i.status}\nCode: ${e}`)}return q.Oi&&console.debug(`<<< ${n} result:`,o),o.result}var nt=n(81965),at=n(80866),rt=n(86719),st=n(20656);function it(t){const{contract:e,method:n,params:a,...r}=t,s=()=>(async()=>{if(Array.isArray(n))return n;if((0,st.d)(n))return(0,at.v)(n);if("function"==typeof n)return(0,at.v)(await n(e));if("string"==typeof n&&n.startsWith("function ")){const t=(0,B.$)(n);if("function"===t.type)return(0,at.v)(t);throw new Error('"method" passed is not of type "function"')}if(e.abi&&e.abi?.length>0){const t=e.abi?.find((t=>"function"===t.type&&t.name===n));if(t)return(0,at.v)(t)}throw new Error(`Could not resolve method "${n}".`)})();return(0,rt.prepareTransaction)({...r,to:e.address,chain:e.chain,client:e.client,data:async()=>{let t;return t=Array.isArray(n)?n:await s(),0===t[1].length?t[0]:t[0]+(0,nt.encodeAbiParameters)(t[1],await(0,h.r)(a??[])).slice(2)}},{preparedMethod:s,contract:e})}var ot=n(3125),ct=n(1013),ut=n(27806),pt=n(7741),dt=n(98753);async function yt(t){const{userOp:e,options:n}=t;if(n.overrides?.paymaster)return n.overrides?.paymaster(e);const a=n.client,r=(0,q.lI)(n.chain),s=n.overrides?.entrypointAddress??q.uh,i=(0,R.KI)(a),o=await i(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[Y(e),s]})}),c=await o.json();if(!o.ok){const t=c.error||o.statusText,e=c.code||"UNKNOWN";throw new Error(`Paymaster error: ${t}\nStatus: ${o.status}\nCode: ${e}`)}if(q.Oi&&console.debug("Paymaster result:",c),c.result)return"string"==typeof c.result?{paymasterAndData:c.result}:{paymasterAndData:c.result.paymasterAndData,verificationGasLimit:c.result.verificationGasLimit?(0,l.uU)(c.result.verificationGasLimit):void 0,preVerificationGas:c.result.preVerificationGas?(0,l.uU)(c.result.preVerificationGas):void 0,callGasLimit:c.result.callGasLimit?(0,l.uU)(c.result.callGasLimit):void 0};const u=c.error?.message||c.error||o.statusText||"unknown error";throw new Error(`Paymaster error from ${r}: ${u}`)}function mt(t){return"smart"===t.id}const lt=new WeakMap,ft=new WeakMap;async function ht(t,e,r){const{personalAccount:i,client:o,chain:c}=e;if(!i)throw new Error("Personal wallet does not have an account");const u=r,p=u.factoryAddress??q.zk,d=c??u.chain,y="gasless"in u?u.gasless:u.sponsorGas;if(function(t){return 324===t.id||300===t.id||302===t.id}(d))return[vt({creationOptions:r,connectionOptions:e,chain:d,sponsorGas:y}),d];const m=(0,s.P)({client:o,address:p,chain:d}),f=await async function(t,e){if(e.overrides?.predictAddress)return e.overrides.predictAddress(t);if(e.overrides?.accountAddress)return e.overrides.accountAddress;const n=e.personalAccountAddress;if(!n)throw new Error("Account address is required to predict the smart wallet address.");const a=(0,l.i3)(e.overrides?.accountSalt??"");return(0,ot.readContract)({contract:t,method:"function getAddress(address, bytes) returns (address)",params:[n,a]})}(m,{personalAccountAddress:i.address,...u}).then((t=>t)).catch((t=>{throw new Error(`Failed to get account address with factory contract ${m.address} on chain ID ${d.id}. Are you on the right chain?`,{cause:t})})),h=(0,s.P)({client:o,address:f,chain:d}),g=await async function(t){const{accountContract:e}=t,r={address:e.address,async sendTransaction(n){const a=function(t){const{accountContract:e,options:n,transaction:a}=t;return n.overrides?.execute?n.overrides.execute(e,a):it({contract:e,method:"function execute(address, uint256, bytes)",params:[a.to||"",a.value||0n,a.data||"0x"]})}({accountContract:e,options:t,transaction:n});return bt({executeTx:a,options:t})},async sendBatchTransaction(n){const a=function(t){const{accountContract:e,options:n,transactions:a}=t;return n.overrides?.executeBatch?n.overrides.executeBatch(e,a):it({contract:e,method:"function executeBatch(address[], uint256[], bytes[])",params:[a.map((t=>t.to||"")),a.map((t=>t.value||0n)),a.map((t=>t.data||"0x"))]})}({accountContract:e,options:t,transactions:n});return bt({executeTx:a,options:t})},async signMessage({message:a}){const[{isContractDeployed:s},{readContract:i},{encodeAbiParameters:o},{hashMessage:c},{checkContractWalletSignature:u}]=await Promise.all([Promise.resolve().then(n.bind(n,27806)),Promise.resolve().then(n.bind(n,3125)),Promise.resolve().then(n.bind(n,81965)),n.e(49728).then(n.bind(n,49728)),n.e(71326).then(n.bind(n,71326))]);await s(e)||(console.log("Account contract not deployed yet. Deploying account before signing message"),await wt({options:t,account:r,accountContract:e}));const p=c(a);let d,y=!1;try{await i({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[p]}),y=!0}catch(t){}if(y){const n=o([{type:"bytes32"}],[p]);d=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:n}})}else d=await t.personalAccount.signMessage({message:a});if(await u({contract:e,message:a,signature:d}))return d;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(s){const i=(0,x.y)(s),[{isContractDeployed:o},{readContract:c},{encodeAbiParameters:u},{checkContractWalletSignedTypedData:p}]=await Promise.all([Promise.resolve().then(n.bind(n,27806)),Promise.resolve().then(n.bind(n,3125)),Promise.resolve().then(n.bind(n,81965)),n.e(98460).then(n.bind(n,98460))]);if(i.domain?.verifyingContract?.toLowerCase()===e.address?.toLowerCase())return t.personalAccount.signTypedData(i);await o(e)||(console.log("Account contract not deployed yet. Deploying account before signing message"),await wt({options:t,account:r,accountContract:e}));const d=(0,a.Z)(i);let y,m=!1;try{await c({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[d]}),m=!0}catch(t){}if(m){const n=u([{type:"bytes32"}],[d]);y=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:n}})}else y=await t.personalAccount.signTypedData(i);if(await p({contract:e,data:i,signature:y}))return y;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},onTransactionRequested:async e=>t.personalAccount.onTransactionRequested?.(e)};return r}({...u,chain:d,sponsorGas:y,personalAccount:i,accountContract:h,factoryContract:m,client:o});return lt.set(i,t),ft.set(t,i),[g,d]}async function gt(t){const e=ft.get(t);e&&(lt.delete(e),ft.delete(t))}function vt(t){const{creationOptions:e,connectionOptions:n,chain:a}=t,s={address:n.personalAccount.address,async sendTransaction(i){const o={data:i.data,to:i.to??void 0,value:i.value??0n,chain:(0,r.Q4)(i.chainId),client:n.client};let c=await async function(t){const{account:e,transaction:n}=t;let[a,r,s,i,o,c,u]=await Promise.all([(0,g.encode)(n),(0,h.r)(n.to),(0,h.r)(n.value),(0,h.r)(n.gas),(0,h.r)(n.maxFeePerGas),(0,h.r)(n.maxPriorityFeePerGas),(0,h.r)(n.eip712).then((t=>t?.gasPerPubdata))]);if(!i||!o||!c){const t=(0,m.getRpcClient)(n),p=await t({method:"zks_estimateFee",params:[{from:e.address,to:r,data:a,value:s?(0,l.cK)(s):void 0}]});i=f(p.gas_limit),o=2n*f(p.max_fee_per_gas),c=f(p.max_priority_fee_per_gas)||1n,u=f(p.gas_per_pubdata_limit)}return{...await(0,v.$)({transaction:{...n,gas:i,maxFeePerGas:o,maxPriorityFeePerGas:c},from:e.address}),...n.eip712,gasPerPubdata:u,from:e.address}}({account:s,transaction:o});if(t.sponsorGas){const t=await async function(t){const e=await et({options:t.options,operation:"zk_paymasterData",params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}({options:{client:n.client,overrides:e.overrides,chain:a},transaction:c});c={...c,...t}}const u=await async function(t){const{account:e,eip712Transaction:n,chainId:a}=t,r=b(n),s=await e.signTypedData({...r});return function(t){const{chainId:e,gas:n,nonce:a,to:r,from:s,value:i,maxFeePerGas:o,maxPriorityFeePerGas:c,customSignature:u,factoryDeps:d,paymaster:y,paymasterInput:m,gasPerPubdata:f,data:h}=t;return`0x${["0x71",p([a?(0,l.nj)(a):"0x",c?(0,l.nj)(c):"0x",o?(0,l.nj)(o):"0x",n?(0,l.nj)(n):"0x",r??"0x",i?(0,l.nj)(i):"0x",h??"0x0",(0,l.nj)(e),(0,l.nj)(""),(0,l.nj)(""),(0,l.nj)(e),s??"0x",f?(0,l.nj)(f):(0,l.nj)(w),d??[],u??"0x",y&&m?[y,m]:[]])].reduce(((t,e)=>t+e.replace("0x","")),"")}`}({...n,chainId:a,customSignature:s})}({account:s,chainId:a.id,eip712Transaction:c}),d=await async function(t){return{transactionHash:(await et({options:t.options,operation:"zk_broadcastTransaction",params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}({options:{client:n.client,overrides:e.overrides,chain:a},transaction:c,signedTransaction:u});return{transactionHash:d.transactionHash,client:n.client,chain:a}},signMessage:async({message:t})=>n.personalAccount.signMessage({message:t}),async signTypedData(t){const e=(0,x.y)(t);return n.personalAccount.signTypedData(e)},onTransactionRequested:async t=>n.personalAccount.onTransactionRequested?.(t)};return s}async function wt(t){const{options:e,account:a,accountContract:r}=t,[{sendTransaction:s},{prepareTransaction:i}]=await Promise.all([Promise.resolve().then(n.bind(n,17350)),Promise.resolve().then(n.bind(n,86719))]),o=i({client:e.client,chain:e.chain,to:r.address,value:0n,gas:50000n});return await s({transaction:o,account:a})}async function bt(t){const{executeTx:e,options:n}=t,a=await async function(t){const{executeTx:e,options:n}=t,a=await(0,ut.isContractDeployed)(n.accountContract)?"0x":await async function(t){const{factoryContract:e}=t,n=function(t){const{factoryContract:e,options:n}=t;return n.overrides?.createAccount?n.overrides.createAccount(e):it({contract:e,method:"function createAccount(address, bytes) returns (address)",params:[n.personalAccount.address,(0,l.i3)(n.overrides?.accountSalt??"")]})}({factoryContract:e,options:t});return(0,K.xW)([e.address,await(0,g.encode)(n)])}(n),r=await(0,g.encode)(e);let{maxFeePerGas:s,maxPriorityFeePerGas:i}=e;const o=n.overrides?.bundlerUrl??(0,q.RZ)(n.chain);if((0,R.Lj)(o)){const t=await async function(t){const e=await et({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:(0,l.uU)(e.maxPriorityFeePerGas),maxFeePerGas:(0,l.uU)(e.maxFeePerGas)}}({options:n});s=t.maxFeePerGas,i=t.maxPriorityFeePerGas}else{const[t,e]=await Promise.all([(0,h.r)(s),(0,h.r)(i)]);if(t&&e)s=t,i=e;else{const a=await(0,ct.G)(n.client,n.chain);i=e??a.maxPriorityFeePerGas??0n,s=t??a.maxFeePerGas??0n}}const c=Q(),u={sender:n.accountContract.address,nonce:c,initCode:a,callData:r,maxFeePerGas:s,maxPriorityFeePerGas:i,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:q.km};if(n.sponsorGas){const t=await yt({userOp:u,options:n}),e=t.paymasterAndData;if(e&&"0x"!==e&&(u.paymasterAndData=e),t.callGasLimit&&t.verificationGasLimit&&t.preVerificationGas)u.callGasLimit=t.callGasLimit,u.verificationGasLimit=t.verificationGasLimit,u.preVerificationGas=t.preVerificationGas;else{const t=await X({userOp:u,options:n});if(u.callGasLimit=t.callGasLimit,u.verificationGasLimit=t.verificationGasLimit,u.preVerificationGas=t.preVerificationGas,e&&"0x"!==e){const t=await yt({userOp:u,options:n});t.paymasterAndData&&"0x"!==t.paymasterAndData&&(u.paymasterAndData=t.paymasterAndData)}}}else{const t=await X({userOp:u,options:n});u.callGasLimit=t.callGasLimit,u.verificationGasLimit=t.verificationGasLimit,u.preVerificationGas=t.preVerificationGas}return{...u,signature:"0x"}}({executeTx:e,options:n}),r=await async function(t){const{userOp:e,options:n}=t,a=function(t){const{userOp:e,entryPoint:n,chainId:a}=t,r=(0,dt.S)(e.initCode),s=(0,dt.S)(e.callData),i=(0,dt.S)(e.paymasterAndData),o=(0,nt.encodeAbiParameters)([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[e.sender,e.nonce,r,s,e.callGasLimit,e.verificationGasLimit,e.preVerificationGas,e.maxFeePerGas,e.maxPriorityFeePerGas,i]),c=(0,nt.encodeAbiParameters)([{type:"bytes32"},{type:"address"},{type:"uint256"}],[(0,dt.S)(o),n,BigInt(a)]);return(0,dt.S)(c)}({userOp:e,entryPoint:n.overrides?.entrypointAddress||q.uh,chainId:n.chain.id});if(n.personalAccount.signMessage){const t=await n.personalAccount.signMessage({message:{raw:(0,pt.aT)(a)}});return{...e,signature:t}}throw new Error("signMessage not implemented in signingAccount")}({options:n,userOp:a}),s=await async function(t){return et({...t,operation:"eth_sendUserOperation",params:[Y(t.userOp),t.options.overrides?.entrypointAddress??q.uh]})}({options:n,userOp:r}),i=await async function(t){const{options:e,userOpHash:n}=t,a=Date.now()+12e4;for(;Date.now()<a;){const t=await tt({options:e,userOpHash:n});if(t)return t;await new Promise((t=>setTimeout(t,1e3)))}throw new Error("Timeout waiting for userOp to be mined")}({options:n,userOpHash:s});return{client:n.client,chain:n.chain,transactionHash:i.transactionHash}}},4427:(t,e,n)=>{n.d(e,{Z:()=>c});var a=n(94531),r=n(25419),s=n(84192),i=n(43264),o=n(60988);function c(t){const{domain:e={},message:n,primaryType:a}=t,s={EIP712Domain:(0,o.H4)({domain:e}),...t.types};(0,o.$$)({domain:e,message:n,primaryType:a,types:s});const c=["0x1901"];return e&&c.push(function({domain:t,types:e}){return u({data:t,primaryType:"EIP712Domain",types:e})}({domain:e,types:s})),"EIP712Domain"!==a&&c.push(u({data:n,primaryType:a,types:s})),(0,i.S)((0,r.xW)(c))}function u({data:t,primaryType:e,types:n}){const a=p({data:t,primaryType:e,types:n});return(0,i.S)(a)}function p({data:t,primaryType:e,types:n}){const r=[{type:"bytes32"}],s=[d({primaryType:e,types:n})];for(const a of n[e]){const[e,i]=m({types:n,name:a.name,type:a.type,value:t[a.name]});r.push(e),s.push(i)}return(0,a.h)(r,s)}function d({primaryType:t,types:e}){const n=(0,s.nj)(function({primaryType:t,types:e}){let n="";const a=y({primaryType:t,types:e});a.delete(t);const r=[t,...Array.from(a).sort()];for(const t of r)n+=`${t}(${e[t].map((({name:t,type:e})=>`${e} ${t}`)).join(",")})`;return n}({primaryType:t,types:e}));return(0,i.S)(n)}function y({primaryType:t,types:e},n=new Set){const a=t.match(/^\w*/u),r=a?.[0];if(n.has(r)||void 0===e[r])return n;n.add(r);for(const t of e[r])y({primaryType:t.type,types:e},n);return n}function m({types:t,name:e,type:n,value:r}){if(void 0!==t[n])return[{type:"bytes32"},(0,i.S)(p({data:r,primaryType:n,types:t}))];if("bytes"===n)return r="0x"+((r.length%2?"0":"")+r.slice(2)),[{type:"bytes32"},(0,i.S)(r)];if("string"===n)return[{type:"bytes32"},(0,i.S)((0,s.nj)(r))];if(n.lastIndexOf("]")===n.length-1){const s=n.slice(0,n.lastIndexOf("[")),o=r.map((n=>m({name:e,type:s,types:t,value:n})));return[{type:"bytes32"},(0,i.S)((0,a.h)(o.map((([t])=>t)),o.map((([,t])=>t))))]}return[{type:n},r]}}}]);